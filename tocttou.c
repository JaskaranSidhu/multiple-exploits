#include <sys/stat.h>  // sruct stat, stat
#include <unistd.h>    // sleep
#include <stdio.h>     // printf, snprintf, fflush, stdout
#include <string.h>    // strlen
#include <stdlib.h>    // system

int additional_security_checks()
{
    printf("Performing security checks...");
    fflush(stdout);
    //TODO: Implement this function; for now we pretend to do something
    //useful.
    sleep(2);
    printf("everything looks good! :)\n");
    return 0;
}

int main(int argc, char ** argv)
{
    if (argc < 2)
    {
        printf("Usage: %s message\n", argv[0]);
        return 1;
    }

    char * cmd = "echo";
    struct stat sb;
    printf("Checking for local copy of echo...");
    if (stat(cmd, &sb) == 0) 
    {
        printf("local copy present! (Switching to /bin/echo)\n");
        cmd = "/bin/echo";
    }
    else printf("none present\n");
 
    if (additional_security_checks()) return 1;

    fflush(stdout);
    printf(" -> Invoking %s: ", cmd);
    char * args[] = { cmd, argv[1], NULL };
    execvp(cmd, args);
}